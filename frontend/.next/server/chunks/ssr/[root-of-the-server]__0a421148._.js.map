{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 88, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Aryan%20Sharma/Desktop/Xeno-fde/frontend/src/app/login/page.tsx"],"sourcesContent":["'use client';\r\nimport axios from 'axios';\r\nimport { useEffect, useRef, useState } from 'react';\r\nimport {\r\n  Bar, BarChart, CartesianGrid, Line, LineChart,\r\n  ResponsiveContainer, Tooltip, XAxis, YAxis\r\n} from 'recharts';\r\n\r\nconst API = process.env.NEXT_PUBLIC_API_URL!;\r\ntype Overview = { totalCustomers: number; totalOrders: number; totalRevenue: number };\r\n\r\nfunction Card({ title, value }: { title: string; value: string | number }) {\r\n  return (\r\n    <div className=\"card p-4 md:p-5\">\r\n      <div className=\"text-xs text-brand-700/80\">{title}</div>\r\n      <div className=\"mt-1 text-3xl font-semibold text-gray-900\">{value}</div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default function Home() {\r\n  // ---- AUTH GATE ----\r\n  const [auth, setAuth] = useState<{ token: string; tenantId: string } | null>(null);\r\n  const [authReady, setAuthReady] = useState(false);\r\n  useEffect(() => {\r\n    const token = localStorage.getItem('token') || '';\r\n    const tenantId = localStorage.getItem('tenantId') || '';\r\n    if (token && tenantId) setAuth({ token, tenantId });\r\n    setAuthReady(true);\r\n  }, []);\r\n\r\n  // if auth not checked yet: render nothing (prevents flicker)\r\n  if (!authReady) return null;\r\n\r\n  // if no auth: go to login immediately\r\n  if (!auth) {\r\n    if (typeof window !== 'undefined') window.location.replace('/login');\r\n    return null;\r\n  }\r\n\r\n  // ---- STATE ----\r\n  const [overview, setOverview] = useState<Overview | null>(null);\r\n  const [series, setSeries] = useState<any[]>([]);\r\n  const [tops, setTops] = useState<any[]>([]);\r\n  const [from, setFrom] = useState('2000-01-01');\r\n  const [to, setTo] = useState('2099-12-31');\r\n\r\n  // Abort previous loads if dates change quickly / during logout\r\n  const abortRef = useRef<AbortController | null>(null);\r\n\r\n  async function load() {\r\n    // safety: never load without auth\r\n    if (!auth) return;\r\n\r\n    // cancel in-flight request\r\n    abortRef.current?.abort();\r\n    const ctrl = new AbortController();\r\n    abortRef.current = ctrl;\r\n\r\n    const headers = { Authorization: `Bearer ${auth.token}` };\r\n    try {\r\n      const [o, s, t] = await Promise.all([\r\n        axios.get(`${API}/api/sync/${auth.tenantId}/metrics/overview`, { headers, signal: ctrl.signal }),\r\n        axios.get(`${API}/api/sync/${auth.tenantId}/metrics/orders-by-date`, { params: { from, to }, headers, signal: ctrl.signal }),\r\n        axios.get(`${API}/api/sync/${auth.tenantId}/metrics/top-customers`, { headers, signal: ctrl.signal }),\r\n      ]);\r\n      setOverview(o.data);\r\n      setSeries(s.data);\r\n      setTops(t.data);\r\n    } catch (err: any) {\r\n      if (err?.name === 'CanceledError' || err?.code === 'ERR_CANCELED') return;\r\n      console.error('Load failed:', err?.message || err);\r\n      // if auth disappeared mid-flight, bounce\r\n      const hasToken = localStorage.getItem('token');\r\n      const hasTenant = localStorage.getItem('tenantId');\r\n      if (!hasToken || !hasTenant) window.location.replace('/login');\r\n    }\r\n  }\r\n\r\n  useEffect(() => { load(); }, [from, to]); // auth is stable now\r\n\r\n  function logout() {\r\n    // stop any requests\r\n    abortRef.current?.abort();\r\n\r\n    // clear local state so page stops rendering data\r\n    setOverview(null);\r\n    setSeries([]);\r\n    setTops([]);\r\n    setAuth(null);\r\n\r\n    // clear storage and HARD redirect (kills React lifecycle)\r\n    localStorage.removeItem('token');\r\n    localStorage.removeItem('tenantId');\r\n    window.location.replace('/login');\r\n  }\r\n\r\n  return (\r\n    <main className=\"space-y-6\">\r\n      {/* header */}\r\n      <div className=\"card p-4 md:p-5 flex items-center justify-between\">\r\n        <div className=\"text-xl font-semibold text-gray-900\">Insights Dashboard</div>\r\n        <div className=\"flex gap-3\">\r\n          <button className=\"btn btn-solid\" onClick={load}>Refresh</button>\r\n          <button className=\"btn-logout\" onClick={logout}>\r\n            <span className=\"inline-flex items-center gap-2\">\r\n              <svg width=\"18\" height=\"18\" viewBox=\"0 0 24 24\" fill=\"none\">\r\n                <path d=\"M15 17l5-5-5-5\" stroke=\"white\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\"/>\r\n                <path d=\"M20 12H9\" stroke=\"white\" strokeWidth=\"2\" strokeLinecap=\"round\"/>\r\n                <path d=\"M12 20H7a3 3 0 0 1-3-3V7a3 3 0 0 1 3-3h5\" stroke=\"white\" strokeWidth=\"2\" strokeLinecap=\"round\"/>\r\n              </svg>\r\n              Logout\r\n            </span>\r\n          </button>\r\n        </div>\r\n      </div>\r\n\r\n      {/* KPIs */}\r\n      <section className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\r\n        <Card title=\"Total Customers\" value={overview?.totalCustomers ?? 0} />\r\n        <Card title=\"Total Orders\" value={overview?.totalOrders ?? 0} />\r\n        <Card title=\"Total Revenue\" value={`â‚¹ ${(overview?.totalRevenue ?? 0).toFixed(2)}`} />\r\n      </section>\r\n\r\n      {/* Filters + Orders by date */}\r\n      <section className=\"space-y-2\">\r\n        <div className=\"flex flex-wrap items-center gap-2\">\r\n          <input className=\"input\" type=\"date\" value={from} onChange={e => setFrom(e.target.value)} />\r\n          <span className=\"text-gray-700\">to</span>\r\n          <input className=\"input\" type=\"date\" value={to} onChange={e => setTo(e.target.value)} />\r\n          <button className=\"btn btn-outline\" onClick={load}>Filter</button>\r\n        </div>\r\n\r\n        <div className=\"card p-3 h-72\">\r\n          <ResponsiveContainer>\r\n            <LineChart data={series}>\r\n              <CartesianGrid strokeDasharray=\"3 3\" stroke=\"#fbcfe8\" />\r\n              <XAxis dataKey=\"d\" tick={{ fill: '#111827' }} />\r\n              <YAxis tick={{ fill: '#111827' }} />\r\n              <Tooltip />\r\n              <Line type=\"monotone\" dataKey=\"orders\" stroke=\"#f35098\" strokeWidth={2} dot={false} />\r\n            </LineChart>\r\n          </ResponsiveContainer>\r\n        </div>\r\n      </section>\r\n\r\n      {/* Top customers */}\r\n      <section className=\"space-y-2\">\r\n        <h2 className=\"text-lg font-semibold text-gray-900\">Top 5 Customers</h2>\r\n        <div className=\"card p-3 h-72\">\r\n          <ResponsiveContainer>\r\n            <BarChart data={tops}>\r\n              <CartesianGrid strokeDasharray=\"3 3\" stroke=\"#fbcfe8\" />\r\n              <XAxis dataKey=\"email\" tick={{ fill: '#111827' }} />\r\n              <YAxis tick={{ fill: '#111827' }} />\r\n              <Tooltip />\r\n              <Bar dataKey=\"spend\" fill=\"#fb79a5\" />\r\n            </BarChart>\r\n          </ResponsiveContainer>\r\n        </div>\r\n      </section>\r\n    </main>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}}]
}